1     0000              ;* * * * *  Small-C/Plus z88dk * * * * *
2     0000              ;  Version: 20190905
3     0000              ;
4     0000              ;	Reconstructed for z80 Module Assembler
5     0000              ;
6     0000              ;	Module compile time: Thu Sep  5 20:49:04 2019
7     0000              
8     0000              
9     0000              
10    0000              	MODULE	test
11    0000              
12    0000              
13    0000              	INCLUDE "z80_crt0.hdr"
1     0000              ;
2     0000              ;	Header file which contains all required variables from the
3     0000              ;	startup that need to be exposed to individual C files
4     0000              ;
5     0000              ;	Stick in this file any routines which are needed or implicitly
6     0000              ;	implied by sccz80.
7     0000              ;
8     0000              ;       This file is included by every module
9     0000              ;       To handle multi module programs which use floating point
10    0000              ;       routines in different modules, we have got rid of
11    0000              ;       the conditional assembly around the float routines
12    0000              ;
13    0000              ;	$Id: z80_crt0.hdr,v 1.12 2015/11/24 06:47:17 stefano Exp $
14    0000              
15    0000              	EXTERN    base_graphics	; Address of graphics screen
16    0000              
17    0000              	EXTERN	_cpfar2near	; Far->near conversion (z88)
18    0000              	EXTERN	packintrout	; Process interrupt (z88 apps)
19    0000              
20    0000              	EXTERN    l_dcal		; jp(hl)
21    0000              	EXTERN    cleanup		; cleanup before program exit
22    0000              
23    0000              
24    0000              	EXTERN     l_jphl        ; another jp(hl)
25    0000              	EXTERN     l_jpix        ; jp(ix)
26    0000              	EXTERN     l_jpiy        ; jp(iy)
27    0000              
28    0000              
29    0000              ;------------------------------------
30    0000              ; Scopes for integer library routines
31    0000              ;------------------------------------
32    0000              
33    0000              	EXTERN    l_getptr		;Get 3 byte pointer
34    0000              	EXTERN    l_putptr		;Put 3 byte pointer
35    0000              	EXTERN    l_gchar		;Get signed char
36    0000              	EXTERN    l_gcharsp	;Get signed char  (peephole opt)
37    0000              	EXTERN    l_gcharspsp	;Get signed char and push  (peephole opt)
38    0000              	EXTERN    l_g2charspsp	;Get 2 signed char and push  (peephole opt)
39    0000              	EXTERN    l_sxt		;Sign extend char
40    0000              	EXTERN    l_gint		;Get int
41    0000              	EXTERN    l_gintsp		;Get int (peephole opt)
42    0000              	EXTERN    l_gintspchar	;Get int,char (peephole opt)
43    0000              	EXTERN    l_gintspsp	;Get int and push (peephole opt)
44    0000              	EXTERN    l_g2intspsp	;Get 2 int and push (peephole opt)
45    0000              	EXTERN    l_gint7de	;Get int, multiply by 7 and add from SP by de
46    0000              	EXTERN    l_gint_eq	;Get int and test == 0
47    0000              	EXTERN    l_ghtonsint	;Get reverse order int
48    0000              	EXTERN    l_pint		;Put int
49    0000              	EXTERN    l_pint_eq	;Put int and test == 0
50    0000              	EXTERN    l_pint_pop	;Put int and pop place address
51    0000              	EXTERN    l_pint_ex	;Put int hl to addr de return addr in hl
52    0000              	EXTERN    l_or		;Int logical or
53    0000              	EXTERN    l_xor		;Int logical xor
54    0000              	EXTERN    l_and		;Int logical and
55    0000              	EXTERN    l_eq		;Int equality
56    0000              	EXTERN    l_ne		;Int inequality
57    0000              	EXTERN    l_gt		;Int signed >
58    0000              	EXTERN    l_le		;Int signed <=
59    0000              	EXTERN    l_ge		;Int signed >=
60    0000              	EXTERN    l_lt		;Int signed <
61    0000              	EXTERN    l_uge		;Int unsigned >=
62    0000              	EXTERN    l_ult		;Int unsigned <
63    0000              	EXTERN    l_ugt		;Int unsigned >
64    0000              	EXTERN    l_ule		;Int unsigned <=
65    0000              	EXTERN    l_cmp		;Int signed compare
66    0000              	EXTERN    l_ucmp		;Int unsigned compare
67    0000              	EXTERN    l_asr		;Int signed >>
68    0000              	EXTERN    l_asr_u		;Int unsigned >>
69    0000              	EXTERN    l_asl		;Int <<
70    0000              	EXTERN    l_sub		;Int subtract
71    0000              	EXTERN    l_neg		;Int negate
72    0000              	EXTERN    l_com		;Int ~
73    0000              	EXTERN    l_lneg		;Int logical negate
74    0000              	EXTERN    l_bool		;Int boolean tetst
75    0000              	EXTERN    l_cm_de		;
76    0000              	EXTERN    l_cm_bc
77    0000              	EXTERN    l_deneg
78    0000              	EXTERN    l_bcneg
79    0000              	EXTERN    l_case		;Integer case
80    0000              	EXTERN    l_mult		;Integer *
81    0000              	EXTERN    l_div		;Integer signed /
82    0000              	EXTERN    l_div_u		;Integer unsigned /
83    0000              
84    0000              ;------------------
85    0000              ;Long functions now
86    0000              ;------------------
87    0000              
88    0000              	EXTERN     lpush2		;Push a long under the stack
89    0000              	EXTERN     l_int2long_s	;Int->long signed conversion
90    0000              	EXTERN     l_int2long_s_float	;Int->long->float signed conversion (optimizer: use -O3)
91    0000              	EXTERN     l_long2int_s	;Long->int signed conversion
92    0000              	EXTERN     l_glong		;Get long
93    0000              	EXTERN     l_glongsp	;Get long and copy on stack (peephole opt)
94    0000              	EXTERN     l_long_add
95    0000              	EXTERN     l_long_and
96    0000              	EXTERN     l_long_asl
97    0000              	EXTERN     l_long_asr
98    0000              	EXTERN     l_long_aslo	;Long << shift in c
99    0000              	EXTERN     l_long_asro	;Long >> shift in c (signed)
100   0000              	EXTERN     l_long_bool
101   0000              	EXTERN     l_long_cmp
102   0000              	EXTERN     l_long_com
103   0000              	EXTERN     l_long_eq
104   0000              	EXTERN     l_long_ge
105   0000              	EXTERN     l_long_gt
106   0000              	EXTERN     l_long_le
107   0000              	EXTERN     l_long_lneg
108   0000              	EXTERN     l_long_lt
109   0000              	EXTERN     l_long_ne
110   0000              	EXTERN     l_long_neg
111   0000              	EXTERN     l_long_or
112   0000              	EXTERN     l_long_sub
113   0000              	EXTERN     l_long_ucmp
114   0000              	EXTERN     l_long_uge
115   0000              	EXTERN     l_long_ugt
116   0000              	EXTERN     l_long_ule
117   0000              	EXTERN     l_long_ult
118   0000              	EXTERN     l_long_xor
119   0000              	EXTERN     l_plong
120   0000              	EXTERN     l_inclong	;Increment long
121   0000              	EXTERN     l_declong	;Decrement long
122   0000              	EXTERN     l_long_div
123   0000              	EXTERN     l_long_div_u
124   0000              	EXTERN     l_long_mult
125   0000              	EXTERN     l_long_asr_u	;Long unsigned >>
126   0000              	EXTERN     l_long_asr_uo	;Long unsigned >> shift in c
127   0000              	EXTERN     l_long_case
128   0000              
129   0000              ;--------------------------------------------------------------
130   0000              ; Floating point support routines, mostly in library
131   0000              ;--------------------------------------------------------------
132   0000              
133   0000              	EXTERN	dadd
134   0000              	EXTERN	ddiv
135   0000              	EXTERN	dsub
136   0000              	EXTERN	dmul
137   0000              
138   0000              	EXTERN	dge
139   0000              	EXTERN	dgt
140   0000              	EXTERN	dleq
141   0000              	EXTERN	dlt
142   0000              	EXTERN	deq
143   0000              	EXTERN	dne
144   0000              
145   0000              	EXTERN	minusfa		;FA=-FA
146   0000              
147   0000              	EXTERN	dswap		;Exchange FA with top of stack
148   0000              	EXTERN   	float		;Convert int to float
149   0000              	EXTERN   	ufloat		;unsigned int to float
150   0000              	EXTERN   	ifix		;Convert float to int
151   0000              
152   0000              	EXTERN	dstore		;FA->(de)
153   0000              	EXTERN	dload		;FA<-(hl)
154   0000              	EXTERN	dldpsh		;(hl)->(stack)
155   0000              	EXTERN	dpush		;FA->(stack)
156   0000              	EXTERN	dpush2		;FA->(stack under)
157   0000              
158   0000              	EXTERN	fa		;may not be needed in this file
159   0000              	EXTERN	extra		;dittot
160   0000              	EXTERN  	__atof2		;string->fa convsersion
161   0000              
162   0000              
163   0000              ;--------------------------------------------------
164   0000              ; Routines for picking up variables from far memory
165   0000              ;--------------------------------------------------
166   0000              
167   0000              	EXTERN	lp_gchar
168   0000              	EXTERN	lp_gdoub
169   0000              	EXTERN	lp_gint
170   0000              	EXTERN	lp_glong
171   0000              	EXTERN	lp_gptr
172   0000              	EXTERN	lp_pchar
173   0000              	EXTERN	lp_pdoub
174   0000              	EXTERN	lp_pint
175   0000              	EXTERN	lp_plong
176   0000              	EXTERN	lp_pptr
177   0000              
178   0000              
179   0000              ;-------------------
180   0000              ; Routines for SDCC
181   0000              ;-------------------
182   0000              
183   0000              	EXTERN     __divsint_rrx_s
184   0000              	EXTERN     __divsint_rrx_hds
185   0000              	EXTERN     __divuint_rrx_s
186   0000              	EXTERN     __divuint_rrx_hds
187   0000              	EXTERN     __divsuchar_rrx_s
188   0000              	EXTERN     __divuschar_rrx_s
189   0000              	EXTERN     __divuchar_rrx_s
190   0000              	EXTERN     __divuchar_rrx_hds
191   0000              	EXTERN     __moduchar_rrx_s
192   0000              	EXTERN     __moduchar_rrx_hds
193   0000              	EXTERN     __moduschar_rrx_s
194   0000              	EXTERN     __modsuchar_rrx_s
195   0000                  EXTERN     __modschar_rrx_s
196   0000              	EXTERN     __modschar_rrx_hds
197   0000              	EXTERN     __modsint_rrx_s
198   0000              	EXTERN     __modsint_rrx_hds
199   0000              	EXTERN     __moduint_rrx_s
200   0000              	EXTERN     __moduint_rrx_hds
201   0000              	EXTERN     __get_remainder
202   0000              	EXTERN     __divunsigned
203   0000                  EXTERN     __div_signexte
204   0000              	EXTERN     __divu16
205   0000              	EXTERN     __div16
206   0000              	EXTERN     __div8
207   0000              	EXTERN     __muluchar_rrx_s
208   0000              	EXTERN     __muluchar_rrx_hds
209   0000              	EXTERN     __mulsuchar_rrx_s
210   0000              	EXTERN     __muluschar_rrx_s
211   0000              	EXTERN     __mulschar_rrx_s
212   0000              	EXTERN     __mulschar_rrx_hds
213   0000              	EXTERN     __mulint_rrx_s
214   0000              	EXTERN     __mulint_rrx_hds
215   0000              	EXTERN     __mul16
216   0000              	EXTERN    	__rrulong_rrx_s
217   0000              	EXTERN    	__rrslong_rrx_s
218   0000              	EXTERN    	__rlslong_rrx_s
219   0000              	EXTERN    	__rlulong_rrx_s
220   0000              
14    0000              
15    0000              
16    0000              	SECTION	code_compiler
17    0000              
18    0000              
19    0000              ._fputc_cons_native
20    0000  C9          	ret
21    0001              
22    0001              
23    0001              
24    0001              ._lcd_display
25    0001  C9          	ret
26    0002              
27    0002              
28    0002              
29    0002              ._main
30    0002  21 00 00    	ld	hl,i_1+0
31    0005  E5          	push	hl
32    0006  CD 01 00    	call	_lcd_display
33    0009  C1          	pop	bc
34    000A  21 00 00    	ld	hl,0	;const
35    000D  C9          	ret
36    000E              
37    000E              
38    000E              	SECTION	rodata_compiler
39    0000              
40    0000              .i_1
41    0000  48 65 6C 6C 6F 20 57 6F 72 6C 64 20 21 
                        	defm	"Hello World !"
42    000D  0D          	defb	13
43    000E              
44    000E              	defm	""
45    000E  00          	defb	0
46    000F              
47    000F              
48    000F              
49    000F              ; --- Start of Static Variables ---
50    000F              
51    000F              	SECTION	bss_compiler
52    0000              
53    0000              	SECTION	code_compiler
54    000E              
55    000E              
56    000E              
57    000E              ; --- Start of Scope Defns ---
58    000E              
59    000E              	PUBLIC	_fputc_cons_native
60    000E              	PUBLIC	_lcd_display
61    000E              	PUBLIC	_main
62    000E              
63    000E              
64    000E              ; --- End of Scope Defns ---
65    000E              
66    000E              
67    000E              ; --- End of Compilation ---
68    000E              
